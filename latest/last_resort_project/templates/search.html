{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card p-4 mb-5 shadow-sm">
            <h2 class="mb-3 text-center">Global Search</h2>
            <form action="/search" method="get" class="d-flex gap-2">
                <input type="text" name="q" class="form-control form-control-lg" 
                       placeholder="Search by Name, Email, Organization or Reservation ID..." 
                       value="{{ query }}">
                <button type="submit" class="btn btn-primary btn-lg">Search</button>
            </form>
        </div>
    </div>
</div>

{% if query %}
    <div class="mb-4">
        <h4><i class="bi bi-people"></i> Guests & Organizations Found ({{ guests|length }})</h4>
        {% if guests %}
        <div class="card shadow-sm">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr><th>ID</th><th>Name / Org</th><th>Type</th><th>Contact</th><th>Action</th></tr>
                </thead>
                <tbody>
                    {% for g in guests %}
                    <tr>
                        <td>#{{ g.partyId }}</td>
                        <td>
                            <strong>
                                {{ g.firstName if g.firstName else '' }} 
                                {{ g.lastName if g.lastName else '' }}
                            </strong>
                            {{ g.orgName if g.orgName else '' }}
                        </td>
                        <td><span class="badge bg-secondary">{{ g.type }}</span></td>
                        <td>
                            {{ g.email }}<br>
                            <small class="text-muted">{{ g.phone }}</small>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-outline-secondary">View</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
            <p class="text-muted">No guests found matching "{{ query }}".</p>
        {% endif %}
    </div>

    <div class="mb-4">
        <h4><i class="bi bi-calendar-check"></i> Reservations Found ({{ reservations|length }})</h4>
        {% if reservations %}
        <div class="card shadow-sm">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr><th>Resv ID</th><th>Guest</th><th>Dates</th><th>Status</th><th>Action</th></tr>
                </thead>
                <tbody>
                    {% for r in reservations %}
                    <tr>
                        <td>#{{ r.resvId }}</td>
                        <td>
                            {{ r.firstName if r.firstName else '' }} 
                            {{ r.lastName if r.lastName else '' }}
                            {{ r.orgName if r.orgName else '' }}
                        </td>
                        <td>{{ r.startDate }} to {{ r.endDate }}</td>
                        <td><span class="badge bg-info text-dark">{{ r.status }}</span></td>
                        <td>
                            {% if r.status == 'Booked' %}
                            <a href="/checkin/{{ r.resvId }}" class="btn btn-sm btn-success">Check In</a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
            <p class="text-muted">No reservations found matching "{{ query }}".</p>
        {% endif %}
    </div>

{% endif %}
{% endblock %}

